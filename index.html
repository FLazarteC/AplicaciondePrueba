<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<script src="https://www.gstatic.com/firebasejs/9.12.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.12.1/firebase-auth-compat.js"></script>
<body>
    <button id="login">Iniciar sesión con Google</button>
    <button id="logout" style="display:none;">Cerrar sesión</button>
    <br>
    <p id="username"></p>
    </br>
    <img src="" alt="" id="user-img">
    <br><br>
    <!-- Botón que solo se muestra si el usuario ha iniciado sesión -->
    <button id="goToMenu" style="display:none;" onclick="window.location.href = 'menu_principal.html';">Ir al Menú Principal</button>

    <!-- Firebase App (the core Firebase SDK) -->
    <script src="firebase.js"></script>

    <script>
        // Obtener referencias de los botones y elementos de la página
        const loginButton = document.getElementById("login");
        const logoutButton = document.getElementById("logout");
        const goToMenuButton = document.getElementById("goToMenu");
        const username = document.getElementById("username");
        const userImg = document.getElementById("user-img");

        // Configuración de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCebnvxBCyTzDAbFrTr1lQBHEJ9RolBIww",
            authDomain: "pkforall-dbd49.firebaseapp.com",
            projectId: "pkforall-dbd49",
            storageBucket: "pkforall-dbd49.firebasestorage.app",
            messagingSenderId: "862448465532",
            appId: "1:862448465532:web:504225c84a92f26078fbf9",
            measurementId: "G-2TMF5G974L"
        };

        // Inicialización de Firebase
        firebase.initializeApp(firebaseConfig);
        const autentificacion = firebase.auth();

        // Evento para iniciar sesión con Google
        loginButton.addEventListener('click', () => {
            const provider = new firebase.auth.GoogleAuthProvider();
            autentificacion.signInWithPopup(provider)
                .then(resultado => {
                    const usuario = resultado.user;
                    mostrarInfoUsuario(usuario);
                })
                .catch(error => {
                    console.error('Error al iniciar sesión', error);
                });
        });

        // Evento para cerrar sesión
        logoutButton.addEventListener('click', () => {
            autentificacion.signOut()
                .then(() => {
                    borrardatos();
                })
                .catch(error => {
                    console.error("Error al cerrar sesión", error);
                });
        });

        // Mostrar la información del usuario
        const mostrarInfoUsuario = (usuario) => {
            username.textContent = `Hola bienvenido, ${usuario.displayName}`;
            userImg.src = usuario.photoURL;
            loginButton.style.display = "none"; // Ocultar el botón de login
            logoutButton.style.display = "inline-block"; // Mostrar el botón de logout
            goToMenuButton.style.display = "inline-block"; // Mostrar el botón para ir al menú principal
        };

        // Borrar los datos del usuario
        const borrardatos = () => {
            username.textContent = '';
            userImg.src = '';
            loginButton.style.display = "inline-block"; // Mostrar el botón de login
            logoutButton.style.display = "none"; // Ocultar el botón de logout
            goToMenuButton.style.display = "none"; // Ocultar el botón para ir al menú principal
        };

        // Comprobar el estado de autenticación del usuario
        autentificacion.onAuthStateChanged(usuario => {
            if (usuario) {
                mostrarInfoUsuario(usuario);
            } else {
                borrardatos();
            }
        });
    </script>

</body>
</html>